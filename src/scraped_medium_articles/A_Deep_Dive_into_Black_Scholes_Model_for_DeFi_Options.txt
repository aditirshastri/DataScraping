url: https://polygontech.medium.com/black-scholes-merton-model-to-price-defi-options-part-1-a-tale-of-the-king-with-torn-clothes-dff043eadea6

Title: A DEEP DIVE INTO BLACK SCHOLES MODEL FOR DEFI OPTIONS
Medium

INTRODUCTION

Black Scholes Merton Model to Price DeFi Options (Part 1): A Tale of The King with Torn Clothes
A Deep-Investigation into Suitability of Black Scholes Merton Model with DeFi Options
So, let’s suppose, you are an aspiring options buildoor. You are excited about your hand-crafted option contracts trading on the blockchain one day. But you don’t know how to price your DeFi options. What do you do? You go ahead and look for some popular pricing mechanisms. One fine day, under an apple tree, in a garden full of butterflies and velvet flowers, you come across the Black Scholes Merton Model, which immediately sends you in a state of epiphany. You are excited about using a valuation model for on-chain price discovery! Epiphany fades, and the realization hits. Realization of it not being perfect for DeFi, and the blockchain infrastructure. Realization that the model’s assumptions are not in line with the blockchain’s intricacies. What adjustments do you gotta make now? Through this article, we 0xlol and Akhil Vajjhala try to investigate the appropriateness of the Black Scholes Merton model (crafted for ancient traditional financial markets) in the context of decentralized finance (built on advanced blockchain technology). You can connect with us on twitter at 0xlol and Akhil.

Before getting started, if you would like a quick review of on-chain or DeFi Options ecosystem, you can read our research article here.

BLACK-SCHOLES-MERTON MODEL
If you are aware of Black Scholes’ intricacies, then you can skip this section on model’s description, and start directly from the next section “The Fault in Our Assumptions”.
The Black–Scholes–Merton model (BSMM) was published in 1973 by Fischer Black, Myron Scholes, and Robert Merton. It is a mathematical valuation model through which derivatives are priced in financial markets. The Black–Scholes formula theoretically estimates the price of European-style options on a stock that doesn’t pay any dividends (during the lifetime of that option). It is widely acknowledged to be amongst the most important mathematical formulae, alongside Newton’s second law and the Pythagorean theorem.
Info-graphic Showcasing the Evolution of Black Scholes Merton Model
What’s the Purpose?
The BSMM’s core principle is “dynamic replication”. This means that, for a given option, you would form a portfolio of risky and risk-free assets (ex. A US Treasury Bond, Cash, etc.) to hedge the risk of the option expiring out of the money. Lily Francus explains this in a more intuitive fashion here:
Black-Scholes, like most derivative pricing, is built on the idea of portfolio replication — given no actor preference, the price of a derivative should be equivalent to the cost of replicating a portfolio (uncreatively called the replicating portfolio) that, over the lifetime of the derivative contract, provides identical cash flows. Identical is doing heavy lifting in that sentence. In practice, very few contracts have a true perfect static (meaning, after t=0, no further buying or selling is needed to hedge during the contract’s lifetime) or even dynamic (further buying/selling/rebalancing) hedge.
Portfolios and options must have the same valuation because their cash-flows are identical. A portfolio would be managed by dynamically rebalancing the weights of the assets without any cash entering or exiting the portfolio — an entirely self-financing portfolio. The main reason for creating such a portfolio is to conserve capital value over time against factors like opportunity cost and inflation. This becomes clearer when we try to understand the intuition behind the Black-Scholes equation.
The Intuition:
The Black-Scholes-Merton Equation (C = Call Option Price, N = Cumulative Distribution Function of the Normal Distribution, S(T) = Spot Price of an Asset, K = Strike Price, r = risk-free interest rate, t = time to maturity)
The intuition behind this equation can be thought of as — how much should one pay (option premium) for the option contract such that the overall investment would cause you to break even? And to break even, it’s necessary that the contract expires in the money (ITM) at a minimum value equal to the sum of strike price and premium paid (price at which this contract was bought) for it.
To put it simply:
You can break even when: Spot Price at Expiry = Strike Price + Option Premium. Therefore, Option Premium = Spot Price at Expiry — Strike PriceYou earn profit when: Spot Price at Expiry &gt; Strike Price + Option PremiumYou are in a loss when: Spot Price at Expiry &lt; Strike Price + Option Premium
Option expiring at-the-money (ATM) would still keep the investor in losses as expenses/costs (option premium) weren’t recovered.
Now that we’ve understood this intuitively, let’s try to understand the two terms in the equation.
The first term of the Black-Scholes equation (“N(d1)St”) describes the projected price of the underlying asset at expiry. In other words, it tells us what price the market expects the underlying asset to reach at the time of the option’s expiry. This essentially tells us about the probability of how far ITM can the option expire. The farther ITM the option expires, greater will be the revenue, and hence greater will be returns or profit generated from it.
The term “N(d2)Ke^-rt” tells us about the cost of exercising an option contract. This cost is only incurred when the option is exercised, so the option needs to be ITM in order for this fee to be paid out. “N(d2)” represents the probability that the option will be ITM, while “Ke^-rt” is the present value of the strike price. This present value is calculated by discounting the strike price (K) by risk free interest rate (r), or RFIR, through the discount formula (e-rt). The price is discounted for RFIR to factor in what is known as the opportunity cost for not investing this capital in a completely risk-free instrument. In other words, it’s the rate of return you could generate without any risk on certain risk-free assets in financial markets.
Essentially, the BSMM formula can be written like this:
Option Premium = Expected Revenue from Exercising the Option — Expected Cost of Exercising the Option
Another way of looking at this equation is by saying that it models the price of an option over time as a sum of the ‘price of underlying asset’ and the ‘risk-premium’. This risk premium is basically the rate of returns (ROR) in excess of RFIRs, and can be considered as the ‘cost’ one pays to the market to hold/bear a risky asset.
Now as we are aware of intricacies involved in BSMM, it will now be easier to investigate all the factors (model’s assumptions) which can determine the compatibility of this model with the decentralized ledgers.

THE FAULT IN OUR S̵T̵A̵R̵S̵ ASSUMPTIONS
BSMM, just like any other mathematical model, takes into account several assumptions:
Option contract is European-style.No transaction costs or taxes are involved in the construction of the dynamic replication portfolio.The portfolio involves a risky as well as a risk-free asset.A constant RFIR to discount the strike price for the present.The probability distribution is Gaussian (normal).The volatility of the underlying asset is a constant function.The underlying asset pays no dividends during the lifetime of the option.There are no arbitrage opportunities in the system.
The accuracy of BSMM’s output depends on these assumptions, so to determine the accuracy of BSMM, these assumptions need to be thoroughly tested!

Specificity and Transaction Costs:
The aforementioned portfolio requires a consistent re-balancing of the risk-free and risky assets, and it should be able to do so at no additional costs (otherwise the portfolio cannot be truly self-financing). What if we create a similar portfolio on the blockchain?
In DeFi, most option positions are fully collateralized. To rebalance such a portfolio, you would need to pay charges to borrow collateral (apart from gas fee) as well as carry out other trades. Such costs result in a wider spread. So not only do such costs impact the pricing accuracy, but they also make the market less liquid and price the options higher than usual. Until someone figures out a way to have a portfolio margin system for the blockchain, this problem shall be a major determining factor in option pricing.
High Gas Fee on Ethereum Shows Why is it Impossible to Construct a Totally Self-Financing Portfolio. Source: CoinMetrics
Also, BSMM assumes options to be of European-style (contracts which can be exercised only at expiry). You definitely can’t use it as it is to price American-style options (contracts that can be exercised before expiration). In 2nd part of this series, we will see how some protocols have been using a modified version of BSMM to price American-style options.
Risk-Free Interest Rates:
BSMM uses a constant RFIR to discount the strike price when calculating the option premium. This is because the model is derived from the replicating portfolio, which requires a constant interest rate for the accurate calculation of value.
In traditional finance, risk-free assets (bonds, bills, and notes) are guaranteed by sovereign governments. The rate of return on such assets over a particular period of time (depending on the maturity) is RFIR. So, this is what you can earn without taking any risks.
Investors use RFIR to estimate the risk-reward ratio for investment and decide whether or not it’s worth taking on extra risk for a potential return.
Risk Premium = Return on Investment — Risk-free rate. Source: WallStreetMojo
Unlike in traditional finance (TradFi), where money printing agencies provide guarantees, in DeFi, the only law is the code written into smart contracts. This begs the question: can we truly have risk-free assets in DeFi? Stablecoins (crypto assets pegged to USD or overcollateralized by other crypto assets) offer partial solutions, as interest earned on these stablecoins from money markets like Aave can be considered risk-free. However, given the various risks associated with stablecoins, this RFIR shall not be ‘risk-free’ totally. Similarly, the conventional RFIR from TradFi can’t be considered completely risk free. So, to each their own!
One can still use the return on US treasury bonds as the RFIR in DeFi. This is because on-chain options are largely measured in dollar value, and thus we can use dollar-value risk-free assets.
Dividends:
BSMM’s assumption that no dividends are paid out during the lifetime of an option doesn’t make sense in light of reality (with DeFi as well as with TradFi). They are very common, and sometimes the primary reason investors hold a particular security. This determinism in asset prices caused by dividends goes against the assumption of BSMM that price fluctuations are completely random (‘normal’ or ‘Gaussian’ probability distribution can only be achieved when price fluctuations are completely random). Such determinism (predictable price action) results in variable volatility, which is another contrast to BSMM’s assumption of constant volatility. Since we can’t assume that no option contracts are active when dividends are paid out, BSMM’s output could be significantly affected by them at any point during an option’s life.

Probability Distributions and Volatility:
Now, what problems can assumptions on ‘distribution being Gaussian’ and ‘constant level of volatility’ create?
Skewed Distributions:
BSMM was based on Bachelier’s assumption that stock returns are normally distributed. The model further went on to take from Paul Samuelson’s conclusions (1950s) that stock prices follow a Geometric Brownian Motion (GBM) with constant drift and level of volatility, i.e. a ‘random walk’ with drift (a positive drift causes an upward trend and vice versa) where the movements of the stock market were a Markov process, i.e. the next state of a stock price (up, down, or same) was entirely probabilistic and could not be predicted.
BSMM works on the assumption that an asset’s risk premium is necessarily normally distributed. To validate this assumption, we plotted probability distributions as well as quantile-quantile or q-q plots for the RORs on BTC and ETH taking into consideration different time intervals (RFIR isn’t accounted for simplicity in calculations).
Probability Distribution and q-q Plots for Bitcoin’s and Ethereum’s Rate of Returns Over Different Time Intervals. Data Source: TradingView
As you can see in the graphs above, the data isn’t normally distributed at all, especially when you take shorter time intervals (anything less than 1 month?) into consideration. This is mainly due to the fact that crypto is highly speculative and narrative-driven. Factors like token unlocks, change in issuance, dividends, fluctuating APY, etc. result in abnormal volatility in shorter time frames. And even if the distribution seems to approach a Gaussian distribution at larger time intervals (ex. 3 months), it is skewed and has fat tails. So, essentially feeding skewed data with excess kurtosis to a model like BSMM can prove to be dangerous for all the agents involved in the options ecosystem.
The data is said to be skewed when it’s not evenly distributed and has a longer tail on either side of the distribution. Skew results in asymmetrical distribution (skewness) with a higher probability of witnessing outliers or extreme events (kurtosis). Kurtosis refers to the peakedness of a distribution. When looking at the RORs at shorter time intervals, cryptocurrencies tend to exhibit excess kurtosis, which means that they have more pronounced tails than a normal distribution. This indicates a greater likelihood of outliers or extreme events.
Implied Volatility is Relatively Stable when Rate of Returns from Higher Time-Intervals are Considered. Source: Skewdotcom (1, 2)
Volatility Not Really A Constant Function:
Now let’s elaborate upon the model’s assumption of volatility being a constant function. As already discussed, the volatility of an underlying asset will continue to change over the lifetime of an option. Over a week’s time, the asset could shift from being quite stable to completely erratic owing to a variety of factors — narratives, supply-demand, interest rates, etc.
There are two types of volatility: historical and implied. Historical volatility is a measure of how much an asset’s price has fluctuated in the past. Implied volatility (IV) on the other hand is a measure of how much an asset’s price is expected to fluctuate in the future. It is a measure of the market’s expectation of the asset’s future volatility and is derived from the prices of the options. The higher the IV, the higher the expected volatility of the instrument. IV is a forward-looking measure of volatility and is affected by a number of factors, including the underlying instrument’s price, the strike price of the options, the time to expiration, the interest rate, and the dividend yield.
But, how does this assumption of a constant level of volatility create problems, especially for on-chain options? First of all, IV is derived from the Black Scholes formula by back-solving it for the value of volatility, using the market price of an at-the-money option as an input. As this IV is calculated by BSMM which assumes a constant level of volatility (which is wrong as described before) the IV i.e. predicted volatility calculated is most probably wrong.
Even after making adjustments to account for certain flawed assumptions (presence of transaction costs, dynamic interest rates for risk-free assets, and dividend payouts), the model still doesn’t seem suitable or efficient enough to price on-chain options. This necessitates either DeFi-specific amendments or an entirely new model. To make DeFi specific adjustments, we must first understand that the flawed factors discussed before don’t work in isolation, but in sync.
One of the ways to study this ‘sync’ is by understanding the fractals witnessed in volatility or IV when the options are actually trading in a free market.


INTO THE DARK ALLIES OF IMPLIED VOLATILITY
Even though we get to see a variety of adjustments made to BSMM by different DeFi protocols (in part 2; to be released next week), major emphasis has been on adjusting for fractals associated with IV. Let’s try to understand such patterns or fractals:
The Smiling Chaos — Volatility Smiles
Every option position has an expiration date and a strike price. At different points in time before this expiry, the value of IV is observed to be different. It results into a phenomenon popularly known as ‘volatility smile’.
Anatomy of A Volatility Smile Source: Investopedia
It has been observed that as we approach the strike price, IV falls, and vice versa. This is because when the underlying asset is trading at a price closer to the strike price, the probability of it being exercised increases. So more certainty = less chaos!
The typical ‘volatility smile’ pattern can be intuitively thought of resulting from the need for option buyers and writers to avoid extreme positions. Option buyers need to stay away from out-of-the-money (OTM) positions because they will lose the premiums they paid, while option writers need to stay away from ITM positions because they are dangerous to their collateral locked into option positions.
Chaos’ Asymmetry — Skew
It’s important to note that a free market will consist of multiple positions rather than a single position. Now let’s consider a set of options with same underlying and expiry, but different strike prices. Ideally, all the contracts in this set should have the same IV, since they are based on the same underlying asset. However, in reality, even if the underlying and expiries are same, we often see IVs differing according to the strike prices.
Considering the aforementioned set of options, at a given point of time, some of them might be closer to their strike prices (ATM), while others might be OTM or ITM. And this proximity or extremity of option contracts to their strike prices will affect their IV (as explained before). The difference in IVs of these contracts is called skew. It describes the asymmetry (skewness) as well as the existence of outliers in the data (kurtosis). A positive skew indicates positive skewness, and vice versa.
An Intuitive Representation of Skewness and Kurtosis. Source: Statistical Aid
Skew also impacts the price of options. For example, suppose investors in the market are bullish on $ETH, and expect prices to go up. In that case, call-option contracts of $ETH with the same expiry but different strike prices will exhibit positive skew. This means that IV for contracts with lower strike prices will be much higher than those with higher strikes. And as IV impacts option premium, contracts with lower strikes (OTM positions w.r.t a standard system) will be much expensive than contracts with higher strikes (ATM or ITM positions w.r.t a standard system). Intuitively — this is because the options with lower strike prices will get them a higher yield than the options with higher-strike prices.
On the other hand, if investors’ sentiments are bearish, to maximize their yields, they would prefer to sell call options with lower strikes as compared to that of higher strikes. This would result into negative skew for call options.
Impact of Strike Prices on IV taking into Account the Skewness and Kurtosis. Source: Oreilly
As we are clear on how skewness impacts option prices, its very easy to understand the impact of kurtosis on option prices. Any asset (and therefore the position) attains high kurtosis due to heightened volatility. Extreme and abnormal volatility result into chaos. And hence, such position will most probably be priced higher given to the risk-reward ratio associated with it.
The Disaster
These IV fractals clubbed with a blockchain’s (or oracle’s) latency is enough to bring on the disaster! But how?
The disaster is brought forth as the crypto clouds start rumbling by the sudden sparks of volatility. This volatility or price change is updated on the blockchain by oracles. Unfortunately due to latency, oracles update these changes later (maybe by a few milliseconds?). This time lag brings about a perfect opportunity for front-running bots to attack those option positions. These bots front-run you by arbitraging on this forthcoming fluctuation in the IV. So till the time blockchain is updated with the correct metrics, your on-chain option traders are probably rekt! This tells you why it is so difficult to incentivize liquidity for on-chain options. Also, this process tells us why BSMM’s assumption of ‘no arbitrage’ doesn’t hold much substance here.

TOWARDS PART -2
The Black Scholes Merton model, which is very sophisticated, does not seem very suitable to price on-chain options. In fact, valuation models like BSMM are not designed to ensure accurate price discovery; they are better suited for ‘valuation’ purposes. Using BSMM ‘as it is’ to price on-chain options can give rise to severe problems such as arbitrage through front running, mispricing due to volatility smiles and skews, and overpricing due to other apparent or non-apparent costs.
When accounting for impact on option prices, ‘skewed distribution’ as a factor is pretty apparent, but other factors like RFIR, dividends, etc. are also important, and shouldn’t be ‘approximated’. It can lead to further complications as described in this research paper.
In next week’s release, we will investigate the various ways option builders are accommodating the faulty assumptions of BSMM. By reviewing their pricing mechanisms in detail, we will try to evaluate different environments in which this mathematical model is being put to work. Can the option builders make everything alright, or are the flaws impossible to fix?


CREDITS
Research and Writing: 0xlol and Akhil Vajjhala
Art Works: Darshan (Illustration), 0xlol (Conceptualization)
Technical Advice:
Individuals: ThogardTeams: Rysk Finance, Premia Finance, Siren, Dopex, Lyra Finance
Quant Analysis: Eshana, Baldwin, Ishank